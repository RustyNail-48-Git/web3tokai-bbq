# Google スプレッドシート連携 セットアップガイド

このガイドでは、参加申込みフォームの回答を Google スプレッドシートに自動保存する方法を説明します。

---

## ステップ 1: Google スプレッドシートを作成

1. [Google スプレッドシート](https://sheets.google.com) にアクセス
2. 「空白のスプレッドシート」を作成
3. **1行目（ヘッダー）** に以下を入力：

| A | B | C | D | E | F | G | H | I | J | K | L | M | N | O |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| タイムスタンプ | お名前 | メールアドレス | 参加区分 | 小中学生の人数 | 幼児の人数 | 交通手段 | 桑名駅ピックアップ | アレルギー | アレルギー詳細 | お住まいエリア | お酒 | 手伝い可能内容 | 自由コメント | 写真動画OK |

> 💡 参加区分は複数選択可（例：「大人、小中学生」）で保存されます。

## ステップ 2: Google Apps Script を設定

1. スプレッドシートのメニューから **「拡張機能」→「Apps Script」** を選択
2. エディタに以下のコードを貼り付け（既存コードは全部消してOK）：

```javascript
function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = JSON.parse(e.postData.contents);

  sheet.appendRow([
    data.timestamp,      // A: タイムスタンプ
    data.name,           // B: お名前
    data.email,          // C: メールアドレス
    data.category,       // D: 参加区分（複数選択：大人、小中学生 など）
    data.studentCount,   // E: 小中学生の人数
    data.infantCount,    // F: 幼児の人数
    data.transport,      // G: 交通手段
    data.pickup,         // H: 桑名駅ピックアップ
    data.allergy,        // I: アレルギー
    data.allergyText,    // J: アレルギー詳細
    data.area,           // K: お住まいエリア
    data.drinking,       // L: お酒
    data.help,           // M: 手伝い可能内容
    data.comments,       // N: 自由コメント
    data.photoConsent    // O: 写真動画OK
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({ result: 'success' }))
    .setMimeType(ContentService.MimeType.JSON);
}
```

3. **Ctrl + S** で保存（プロジェクト名は何でもOK）

## ステップ 3: ウェブアプリとしてデプロイ

1. 右上の **「デプロイ」→「新しいデプロイ」** をクリック
2. 歯車アイコン ⚙️ → **「ウェブアプリ」** を選択
3. 設定：
   - **説明**: `参加申込みフォーム`
   - **実行するユーザー**: `自分`
   - **アクセスできるユーザー**: `全員`
4. **「デプロイ」** をクリック
5. アクセスを承認（Googleアカウントの認証画面が出ます）
6. 表示された **ウェブアプリURL** をコピー

> ⚠️ **既にデプロイ済みの場合**：「デプロイ」→「デプロイを管理」→ 鉛筆アイコン ✏️ → バージョンを **「新しいバージョン」** に変更 →「デプロイ」で更新できます。URLは変わりません。

## ステップ 4: フォームにURLを設定

`script.js` を開き、以下の行を見つけてURLを貼り付け：

```javascript
// 変更前
const SCRIPT_URL = '';

// 変更後（例）
const SCRIPT_URL = 'https://script.google.com/macros/s/xxxxx/exec';
```

---

## 完了！🎉

これでフォームから送信されたデータが自動的にスプレッドシートに保存されます。

## ステップ 5: 集計シートの設定

回答データを自動集計するために、「集計」シートを作成して以下の関数を入力します。
回答が追加されるたびに自動で数字が更新されます。

> ⚠️ 以下では回答データのシート名を **「シート1」** としています。
> シート名が違う場合は `シート1` の部分をご自身のシート名に変更してください。

### 参加人数

| セル | 内容 | 入力する値 |
|---|---|---|
| A1 | 見出し | `📊 参加人数` |
| A2 | ラベル | `申込み件数` |
| B2 | 関数 | `=COUNTA(シート1!B:B)-1` |
| A3 | ラベル | `大人` |
| B3 | 関数 | `=COUNTIF(シート1!D:D,"*大人*")` |
| A4 | ラベル | `小中学生` |
| B4 | 関数 | `=SUM(シート1!E:E)` |
| A5 | ラベル | `幼児` |
| B5 | 関数 | `=SUM(シート1!F:F)` |
| A6 | ラベル | **`合計参加人数`** |
| B6 | 関数 | `=B3+B4+B5` |
| A7 | ラベル | `残り枠（定員24名）` |
| B7 | 関数 | `=24-B6` |

### 交通手段・送迎

| セル | 内容 | 入力する値 |
|---|---|---|
| A9 | 見出し | `🚗 交通手段` |
| A10 | ラベル | `自家用車` |
| B10 | 関数 | `=COUNTIF(シート1!G:G,"自家用車")` |
| A11 | ラベル | `電車` |
| B11 | 関数 | `=COUNTIF(シート1!G:G,"電車")` |
| A13 | 見出し | `🚉 桑名駅ピックアップ` |
| A14 | ラベル | **`希望する`** |
| B14 | 関数 | `=COUNTIF(シート1!H:H,"希望する")` |
| A15 | ラベル | `不要` |
| B15 | 関数 | `=COUNTIF(シート1!H:H,"不要")` |

### アレルギー

| セル | 内容 | 入力する値 |
|---|---|---|
| A17 | 見出し | `⚠️ アレルギー` |
| A18 | ラベル | `あり` |
| B18 | 関数 | `=COUNTIF(シート1!I:I,"あり")` |
| A19 | ラベル | `なし` |
| B19 | 関数 | `=COUNTIF(シート1!I:I,"なし")` |
| A20 | 補足 | `※詳細は回答シートのJ列を確認` |

### お酒

| セル | 内容 | 入力する値 |
|---|---|---|
| A22 | 見出し | `🍺 お酒` |
| A23 | ラベル | `飲む` |
| B23 | 関数 | `=COUNTIF(シート1!L:L,"飲む")` |
| A24 | ラベル | `飲まない` |
| B24 | 関数 | `=COUNTIF(シート1!L:L,"飲まない")` |

### 手伝い可能内容

| セル | 内容 | 入力する値 |
|---|---|---|
| A26 | 見出し | `🤝 手伝い` |
| A27 | ラベル | `買い出し` |
| B27 | 関数 | `=COUNTIF(シート1!M:M,"*買い出し*")` |
| A28 | ラベル | `設営` |
| B28 | 関数 | `=COUNTIF(シート1!M:M,"*設営*")` |
| A29 | ラベル | `片付け` |
| B29 | 関数 | `=COUNTIF(シート1!M:M,"*片付け*")` |
| A30 | ラベル | `参加のみ` |
| B30 | 関数 | `=COUNTIF(シート1!M:M,"*参加のみ*")` |

### 写真・動画共有

| セル | 内容 | 入力する値 |
|---|---|---|
| A32 | 見出し | `📷 写真・動画共有` |
| A33 | ラベル | `OK` |
| B33 | 関数 | `=COUNTIF(シート1!O:O,"OK")` |
| A34 | ラベル | `NG` |
| B34 | 関数 | `=COUNTIF(シート1!O:O,"NG")` |

> 💡 **ポイント**: `*` はワイルドカードです。「買い出し、片付け」のように複数選択されていても正しくカウントされます。

---

## GitHub Pages で公開する方法

1. GitHubにリポジトリを作成（または既存のリポジトリを使用）
2. `index.html`、`style.css`、`script.js` をアップロード
3. **Settings → Pages → Source** で `main` ブランチを選択
4. 数分後にURLが表示されます → このURLをLINEなどで共有！
